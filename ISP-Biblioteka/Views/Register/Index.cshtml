
@{
    Layout = null;

}
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>
<link href="~/Content/bootstrap.min.css" rel="stylesheet" />

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Prisijungimas</title>
</head>
<body>
    <div class="container" style="margin-top:10%">
        <div class="row">
            <div class="col-md-4 col-md-offset-4 alert alert-info">
                <h3 class="text-center">Prisijungimas</h3>
                <form id="loginForm">
                    <div id="msg"><ul style="color:red;">Neteisingas vartotojo vardas ar slaptažodis</ul></div>
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
                            <input class="form-control" type="email" name="Email" id="logEmail" placeholder="Elektroninis paštas" />
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                            <input class="form-control" type="password" name="Password" id="logPssword" placeholder="Slaptažodis" />
                        </div>
                    </div>
                </form>
                <div class="form-group">
                    <button class="btn btn-info form-control" type="submit" onclick="Login()"><i class="glyphicon glyphicon-log-in"></i>  Prisijungti</button>
                </div>
                <div class="form-group">
                    <a style="float:left" onclick="RemindPsw()">Pamiršau slaptažodį!</a><a style="float:right;cursor:pointer" onclick="SignUp()">Registracija</a>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="ShowModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <a href="#" class="close" data-dismiss="modal">&times;</a>
                    <h4>Registracijos anketa</h4>
                    <div id="message1">
                        <div class="alert alert-success">
                            <span class="glyphicon glyphicon-ok"></span><strong>
                                Registracija sėkminga!<br />
                                Nusiuntėme patvirtinimo nuorodą į jūsų el. pašto dėžutę.<br />
                            </strong>
                        </div>
                    </div>
                    <div id="message2">
                        <div class="alert alert-danger">
                            <span class="glyphicon glyphicon-remove"></span><strong>Klaida! Registracija nesėkminga, patikrinkite įvedimo laukelius.</strong>
                        </div>
                    </div>
                    <div id="message3">
                        <div class="alert alert-danger">
                            <span class="glyphicon glyphicon-remove"></span><strong>Klaida! Slaptažodžiai nesutampa.</strong>
                        </div>
                    </div>
                    <div id="message4">
                        <div class="alert alert-danger">
                            <span class="glyphicon glyphicon-remove"></span><strong>Klaida! Vartotojas su šiuo elektroniniu paštu jau egzistuoja.</strong>
                        </div>
                    </div>
                    <div id="message5">
                        <div class="alert alert-danger">
                            <span class="glyphicon glyphicon-remove"></span><strong>Klaida! Įveskite tinkamą elektroninį paštą.</strong>
                        </div>
                    </div>
                </div>
                <div class="modal-body">
                    <form id="Registration">
                        <div class="form-group">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
                                <input class="form-control" type="email" name="Email" id="Email" placeholder="Elektroninis paštas" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                                <input class="form-control" type="password" name="Password" id="Password" placeholder="Slaptažodis" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                                <input class="form-control" type="password" name="Password2" id="Password2" placeholder="Pakartoti slaptažodį" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                                <input class="form-control" type="text" name="Name" id="Name" placeholder="Vardas" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                                <input class="form-control" type="text" name="Surname" id="Surname" placeholder="Pavardė" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-earphone"></i></span>
                                <input class="form-control" type="text" name="Phone" id="Phone" placeholder="Telefonas" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-home"></i></span>
                                <input class="form-control" type="text" name="Address" id="Address" placeholder="Adresas" />
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-group">
                                <span class="input-group-addon"><label>Lytis</label></i></span>
                                <div style="padding-left:5px; padding-top: 2px;">
                                    <input type="radio" name="Gender" id="gen_male" value="1"><label class="gender_radio">Vyras</label>
                                    <input type="radio" name="Gender" id="gen_female" value="0"><label class="gender_radio">Moteris</label>
                                </div>
                            </div>
                        </div>
                    </form>
                    <div class="form-group">
                        <button class="btn btn-info form-control" type="submit" onclick="SaveForm()"><i class="glyphicon glyphicon-registration-mark"></i>Pateikti</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="ShowModalPsw">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <a href="#" class="close" data-dismiss="modal">&times;</a>
                    <h4>Slaptažodžio atkūrimas</h4>
                    <div id="messagePsw1">
                        <div class="alert alert-success">
                            <span class="glyphicon glyphicon-ok"></span><strong>
                                Atkūrimas sėkmingas!<br />
                                Nusiuntėme slaptažodžio atkūrimo nuorodą į jūsų elektroninio pašto dėžutę.<br />
                            </strong>
                        </div>
                    </div>
                    <div id="messagePsw2">
                        <div class="alert alert-danger">
                            <span class="glyphicon glyphicon-remove"></span><strong>Klaida! Vartotojas su šiuo elektroniniu paštu nerastas.</strong>
                        </div>
                    </div>
                </div>
                <div class="modal-body">
                    <form id="EmailReminderForm">
                        <div class="form-group">
                            <div class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
                                <input class="form-control" type="email" name="EmailReminder" id="EmailReminder" placeholder="Elektroninis paštas" />
                            </div>
                        </div>
                    </form>
                    <div class="form-group">
                        <button class="btn btn-info form-control" type="submit" onclick="PasswordReminder()"><i class="glyphicon glyphicon-registration-mark"></i>Pateikti</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        input[type=radio] {
            display: inline;
        }
        .gender_radio {
            padding-left: 5px;
            padding-right: 5px;
        }
    </style>
    <script>
        function SignUp() {
            $("#ShowModal").modal();
            Hide();
        }

        function RemindPsw() {
            $("#ShowModalPsw").modal();
            $("#messagePsw1").hide();
            $("#messagePsw2").hide();            
        }

        function atLeastOneRadio() {
            if (document.getElementById('gen_male').checked ||
                document.getElementById('gen_female').checked) {
                return true;
            }
            return false;
        }

        function validateEmail(email) {
            const re = /^(([^<>()\[\]\\.,;:\s@@"]+(\.[^<>()\[\]\\.,;:\s@@"]+)*)|(".+"))@@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(String(email).toLowerCase());
        }

        function Hide() {
            $("#message1").hide();
            $("#message2").hide();
            $("#message3").hide();
            $("#message4").hide();
            $("#message5").hide();
        }

        function addUser() {
            //Perduodami duomenys backui itraukti vartotoja i db
            var data = $("#Registration").serialize();
            $.ajax({
                type: "post",
                data: data,
                url: "/Register/AddUser",
                success: function (result) {
                    Hide();
                    $("#message1").show();
                    $("#Registration")[0].reset();
                }
            });
        }

        function PasswordReminder() {
            var email = $("#EmailReminder").val();

            //Tikrinamas elektroninio pašto vientisumas
            if (!validateEmail(email)) {
                $("#messagePsw1").hide();
                $("#messagePsw2").show();
                return false;
            }

            //Tikrinama, ar yra toks vartotojas su tokiu emailu
            $.ajax({
                type: "post",
                data: { 'email': email },
                url: "/Register/CheckEmail",
                success: function (result) {
                    if (result == "Fail") {
                        $("#messagePsw1").hide();
                        $("#messagePsw2").show();
                        return false;
                    }
                    else {
                        $("#messagePsw2").hide();
                        $("#messagePsw1").show();
                    }
                }
            });
        }

        function SaveForm() {
            var password = $("#Password").val();
            var password2 = $("#Password2").val();
            var email = $("#Email").val();
            var name = $("#Name").val();
            var surname = $("#Surname").val();
            var phone = $("#Phone").val();
            var address = $("#Address").val();
            var gender = $("#Gender").val();

            //Tikrinami ar visi laukai užpildyti (be nuotraukos)
            if (password == "" || password2 == "" || email == "" ||
                name == "" || surname == "" || phone == "" || address == "" || !atLeastOneRadio()) {
                Hide();
                $("#message2").show();
                return false;
            }

            //Tikrinami ar slaptažodžiai sutampa
            if (password != password2) {
                Hide();
                $("#message3").show();
                return false;
            }

            //Tikrinamas elektroninio pašto vientisumas
            if (!validateEmail(email)) {
                Hide();
                $("#message5").show();
                return false;
            }

            //Tikrinama, ar nėra tokio vartotojo emailo
            var data = $("#Registration").serialize();
            $.ajax({
                type: "post",
                data: data,
                url: "/Register/CheckUser",
                success: function (result) {
                    if (result == "Fail") {
                        Hide();
                        $("#message4").show();
                        return false;
                    }
                    else {
                        addUser();
                    }
                }
            });

        }

        //Login System
        $("#msg").hide();

        var Login = function () {
            var data = $("#loginForm").serialize();
            $.ajax({
                type: "post",
                url: "/Register/CheckValidUser",
                data: data,
                success: function (result) {
                    if (result == "Fail") {
                        $("#loginForm")[0].reset();
                        $("#msg").show();
                    }
                    else {
                        window.location.href = "/Register/AfterLogin";
                        $("#msg").hide();
                    }
                }
            })
        }
    </script>
</body>
</html>
